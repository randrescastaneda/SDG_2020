---
title: "SDG 10"
output:
  xaringan::moon_reader:
    seal: false
    css: ["css/sfah.css", "css/fonts.css", "default"]
    self_contained: false
    lib_dir: libs
    mathjax: "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML"
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      titleSlideClass: ["left", "middle", "inverse"]
---
```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(knitr)
library(scales)

knitr::opts_chunk$set(
  warning = FALSE,
  collapse = TRUE,
  message = FALSE,
  echo = FALSE,
  fig.retina = 3,
  fig.width = 10
)
knitr::opts_knit$set(
  root.dir = ".."
)
# options(knitr.table.format = "html")
library(fontawesome) # from github: https://github.com/rstudio/fontawesome
xaringanExtra::use_xaringan_extra(c("tile_view", "animate_css", "tachyons"))
```

class: inverse, right, bottom
## SDG Atlas 2020

## Goal 10: Reduce inequality within and among countries

???
Intcomments

---

class: middle, center, inverse

### Story of inequality
```{r distsim}
source("R/utils.R")
source("R/SDG_10_lorenz.R")
```
---
class: middle, center, inverse

### Relative inequality
---

.left-column[
### Start with perfect equality

.big[Everybody has the same amount of money]
]
.right-column[
```{r pe1}

set.seed(1010111)
plt <- sample(palette, size = 4)

breaks <- df %>%
  group_by(src) %>%
  summarise(
    gini = gini(y,w)
  ) %>%
  arrange(-gini) %>%
  pull(src)

f <- df %>% 
  group_by(src) %>%  
  filter(
      abs(cw-.25) == min(abs(cw-.25))
    | abs(cw-.5)  == min(abs(cw-.5))
    | abs(cw-.75) == min(abs(cw-.75))
      ) %>% 
  select(src, x2 = cw, y1 = cy) %>% 
  mutate(y2 = y1,
         x1  = 0) 


pe <- ggplot() +
  geom_line(data=filter(df, src %in% breaks[4]),
             aes(x=cw,
                 y=cy,
                 color = src)
            ) +
  scale_x_continuous(name="Cumulative share of population", limits=c(0,1)) +
  scale_y_continuous(name="Cumulative share of welfare", limits=c(0,1)) +
  theme_classic() +
  scale_color_manual(values= plt,
                     breaks = breaks)
pe

```
]

---
.left-column[
### Start with perfect equality

welfare and population cummulate at the same pace. So, the bottom 25 percent of the population has 25% of the total income
]
.right-column[
```{r pe2}

sgm <- data.frame(x1 = 0, x2 = 0.25, y1 = 0.25, y2 = .25)

pe2 <- pe +
  geom_segment(aes(x = x1, y = y1, xend = x2, yend = y2), colour = palette[10], data = sgm) +
  geom_segment(aes(x = y1, y = x1, xend = y2, yend = x2), colour = palette[10], data = sgm)
pe2
```
]

---
.left-column[
### Start with perfect equality

Welfare and population cummulate at the same pace. So, the bottom 25 percent of the population has 25% of the total income. The bottom 50 of the population has 50 percent of total income, and so on... 

]
.right-column[
```{r pe3}

sgm2 <- data.frame(x1 = 0, x2 = .5, y1 = .5, y2 = .5)

pe3 <- pe2 +
  geom_segment(aes(x = x1, y = y1, xend = x2, yend = y2), colour = palette[10], data = sgm2) +
  geom_segment(aes(x = y1, y = x1, xend = y2, yend = x2), colour = palette[10], data = sgm2)

pe3
```
]

---
.left-column[
### A real case example
.big[South Africa]

Here we can see how far from perfect equality this country is. 

]
.right-column[
```{r zaf1}
pzaf <- pe + 
  geom_line(data= filter(df, src %in% breaks[1]),
       aes(x=cw,
           y=cy,
           color = src)
       ) 
pzaf
```
]
---
```{r zaf2}

f1 <- f %>% 
  filter(src  %in% breaks[1]) %>% 
  slice(1)

sz1 <-  list(geom_segment(aes(x    = x1, 
                   y    = y1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = f1
               ) ,
  geom_segment(aes(x    = x2, 
                   y    = x1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = f1
               )
)
pzaf1 <- pzaf + sz1
```

.left-column[
### A real case example
.big[South Africa]

The bottom 25% of the population has only `r percent(f1$y1, accuracy = 0.1)` of total welfare

]
.right-column[

```{r }
pzaf1
```

]
---
```{r zaf3}

f2 <- f %>% 
  filter(src  %in% breaks[1]) %>% 
  slice(2)

sz2 <- list(
  geom_segment(aes(x    = x1, 
                   y    = y1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = f2
               ) ,
  geom_segment(aes(x    = x2, 
                   y    = x1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = f2
               )
)
pzaf2 <- pzaf1 + sz2
```
.left-column[
### A real case example
.big[South Africa]

The bottom 25% of the population has only `r percent(f1$y1, accuracy = 0.1)` of total welfare, 
and the bottom 50% has around `r percent(f2$y1, accuracy = 0.1)`. 

]
.right-column[
```{r }
pzaf2
```
]
---
```{r zaf4}

f3 <- f %>% 
  filter(src  %in% breaks[1]) %>% 
  slice(3)

sz3 <- list(
geom_segment(aes(x    = x1, 
                   y    = y1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = f3
               ) ,
  geom_segment(aes(x    = x2, 
                   y    = x1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = f3
               )
)

pzaf3 <- pzaf2 + sz3
```
.left-column[
### A real case example
.big[South Africa]

The bottom 25% of the population has only `r percent(f1$y1, accuracy = 0.1)` of total welfare, 
and the bottom 50% has around `r percent(f2$y1, accuracy = 0.1)`. Finally, the bottom 75% of the 
population has merely the `r percent(f3$y1, accuracy = 0.1)` of total welfare. 

]
.right-column[
```{r }
pzaf3
```

]
---
```{r fin}
gpfin  <- geom_line(data= filter(df, src %in% breaks[3]),
                         aes(x=cw,
                             y=cy,
                             color = src))
pfin <- pzaf + gpfin
```
.left-column[
### Let's compare
.big[Findland]

We can see that this is a more equalitarian country
]
.right-column[
```{r }
pfin
```
]
---
```{r fin1}

q1 <- f %>% 
  filter(src  %in% breaks[3]) %>% 
  slice(1)

sf1 <- list(
  geom_segment(aes(x    = x1, 
                   y    = y1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = q1
               ) ,
  geom_segment(aes(x    = x2, 
                   y    = x1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = q1
               )

)


pfin1 <- pzaf1 + gpfin + sf1
    
```
.left-column[
### Let's compare
.big[Findland]

In contrast to South Africa, the bottom 25% of the population in Findaly has 
`r percent(q1$y1, accuracy = 0.1)` of total welfare, 

]
.right-column[
```{r }
pfin1
```
]
---
```{r fin2}
q2 <- f %>% 
  filter(src  %in% breaks[3]) %>% 
  slice(2)

sf2 <- list(
  geom_segment(aes(x    = x1, 
                   y    = y1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = q2
               ) ,
  geom_segment(aes(x    = x2, 
                   y    = x1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = q2
               )
  
)


pfin2 <- pzaf  + sz2  +
         gpfin + sf2
  
```
.left-column[
### Let's compare
.big[Findland]

In contrast to South Africa, the bottom 25% of the population in Findaly has 
`r percent(q1$y1, accuracy = 0.1)` of total welfare, and the bottom 50% has around 
`r percent(q2$y1, accuracy = 0.1)`. 

]
.right-column[
```{r }
pfin2
```
]
---
```{r fin3}

q3 <- f %>% 
  filter(src  %in% breaks[3]) %>% 
  slice(3)

sf3 <- list(
  geom_segment(aes(x    = x1, 
                   y    = y1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = q3
               ) ,
  geom_segment(aes(x    = x2, 
                   y    = x1, 
                   xend = x2, 
                   yend = y2
                   ), 
               colour = palette[10], 
               data = q3
               )
  
)


pfin3 <- pzaf  + sz3  +
         gpfin + sf3
```
.left-column[

### Let's compare
.big[Findland]

In contrast to South Africa, the bottom 25% of the population in Findaly has 
`r percent(q1$y1, accuracy = 0.1)` of total welfare, and the bottom 50% has around 
`r percent(q2$y1, accuracy = 0.1)`. Finally, the bottom 75% of the 
population has merely the `r percent(q3$y1, accuracy = 0.1)` of total welfare.

]
.right-column[
```{r}
pfin3
```
]
---
### Relative Vs Absolute inequality

```{r p1090-calc}
source("R/SDG_10_p10p90p50.R")
```

.big[This kind of inequality is known as realtive inequality because it depends on the distribution of welfare within the context in which it is measured. That is, relative inequality does not say anything about the level of welfare between two countries. It only allows us to see if the inequality between the population of one country has icreased or decreased over time, but does not say anything about how unequal the populations of two different economies are. We need thus absolute measures of inequality for this endeavor. 
]

---
.left-column[
### another way to see inequality

]
.right-column[
```{r twocts}
p_p10p90_2c
```
]
---

.left-column[
### values of p90 and p10

]
.right-column[
```{r twop90p10}
p_p10p90_2c  +
  geom_label_repel(
    aes(y     = p10,
        label = scales::dollar(p10) ),
    show.legend = FALSE,
    force = 1,
    box.padding = 1,
    segment.curvature = .5,
    # max.overlaps = 2,
    # segment.ncp = 3,
    segment.angle = 20,
    # nudge_y = 5
  ) +
  geom_label_repel(
    aes(y     = p90,
        label = scales::dollar(p90) ),
    show.legend = FALSE,
    force = 10,
    box.padding = 2,
    segment.curvature = .5,
    # max.overlaps = 2,
    # segment.ncp = 3,
    segment.angle = 20,
    # nudge_y = 5
  )

```
]

---
.left-column[
### the ration between p90 and p10 is
]
.right-column[
```{r }

```
]

---
.left-column[
### But how to measure the inequality between people in FIN and ZAF?

--- 

We could show the ratio between the medians. 

--

But that can only be done country by country by country. 

]
.right-column[
```{r }
p_p10p90_2c  +
  geom_label_repel(
    aes(y     = p50,
        label = scales::dollar(p50) ),
    show.legend = FALSE,
    force = 1,
    box.padding = 1,
    segment.curvature = .5,
    # max.overlaps = 2,
    # segment.ncp = 3,
    segment.angle = 20,
    # nudge_y = 5
  )
```
]
