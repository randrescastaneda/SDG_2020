---
output:
  xaringan::moon_reader:
    seal: false
    css: ["css/sfah.css", "css/fonts.css", "default"]
    self_contained: false
    lib_dir: libs
    mathjax: "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML"
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      titleSlideClass: ["left", "middle", "inverse"]
---
```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(knitr)
library(data.tree)

knitr::opts_chunk$set(
  warning = FALSE,
  collapse = TRUE,
  message = FALSE,
  echo = FALSE,
  fig.retina = 3,
  fig.width = 10
)
knitr::opts_knit$set(
  root.dir = ".."
)
# options(knitr.table.format = "html")
library(fontawesome) # from github: https://github.com/rstudio/fontawesome

```

class: inverse, right, bottom
background-image: url(img/abst1.jpg)
background-size: cover
## SDG Atlas 2020

## Goal 10: Reduce inequality within and among countries

---
```{r ginichange}
source("R/SDG_10_Gini_Change.R")

```

.left-column[
.small[From the mid 90's to 2010, the *average* Gini coefficient decreased steadly. Since then, the trend has reverted and the average inequality is increasing rapidly.]
]

.right-column[
```{r giniav}
p_av_g +
  geom_vline(xintercept = c(1996, 2010, 2013),
             color = "gray70")
```
]

---
.left-column[
.small[When we look at the trends at the region level, it is not very clear where the action is happening]
]
.right-column[
```{r giniregs}
p_av_gr
```
]
---

.left-column[
.small[SO, let's look at in a differnet way]
]
.right-column[
```{r gini45}
p_g
```
]

---
.left-column[
.small[LAC is the region that consistently has reduced inequality in most countries. This makes sense because inequality is measured with income-based welfare, which is by definition higher than consumption-based welfare,  so there is more room to improve. ]
]
.right-column[
```{r gini45lac}
p_g +
  ggforce::geom_mark_hull(
    aes(filter = region == 'LAC',
        fill = region,
        label = region),
    show.legend = FALSE,
    expand = unit(2, "mm"),
    concavity = 1
  )
``` 
]

---
.left-column[
.small[When we look at other regions, we don't find the same patterns.]
]
.right-column[
```{r gini45SSA}
p_g +
  ggforce::geom_mark_hull(
    aes(filter = region == 'SSA',
        fill = region,
        label = regionname),
    show.legend = FALSE,
    expand = unit(2, "mm"),
    concavity = 1
  )
```
]

---
.left-column[
.small[When we look at other regions, we don't find the same patterns.]
]
.right-column[
```{r gini45EAP}

p_g +
  ggforce::geom_mark_hull(
    aes(filter = region == 'EAP',
        fill = region,
        label = regionname),
    show.legend = FALSE,
    expand = unit(2, "mm"),
    concavity = 1
  )
```
]

---
class: inverse
## Another way to see inequality
---

```{r p1090-calc}
source("R/SDG_10_p10p90p50.R")
```

.left-column[
Here, countries are organized according to their median, from lowest to highest.
]
.right-column[
```{r p50}
p_p50
```
]

---
.left-column[
From `r dfc_p50[["countryname"]][1]` to `r dfc_p50[["countryname"]][nrow(dfc_p50)]`.
]
.right-column[
```{r p50l}
p_p50 +
  geom_label_repel(
    data = dfc_p50,
    aes(label = text,
        fill  = region),
    show.legend = FALSE,
    force = 20,
    box.padding = 1.2,
    # max.overlaps = 2,
    segment.curvature = 0.5,
    # segment.ncp = 3,
    # segment.angle = 20,
    nudge_y = 5
  )

```
]
---
.left-column[
Now, let's remove the labels and add the monetary distance between the 10th and 90th percentiles. 
]
.right-column[
```{r p50l2}
p_p50
```
]
---
.left-column[
Now, let's remove the labels and add the monetary distance between the 10th and 90th percentiles. 

Done.
]
.right-column[
```{r p1090g}
p_p10p90
```
]
---
.left-column[
Based on the length of the bars, it seems that there is more inequality within the rich countries than within poor countries, as the bars are way higher among the former than among the latter.
]
.right-column[
```{r p1090g2}
p_p10p90
```
]
---
.left-column[
Yet, that is a visual ilusion because the ratio between the 90th percentile to the 10th percentile is higher in poorer countries than in rich countries.
]
.right-column[
```{r p1090g3}
p_p10p90
```
]

---
```{r}
sp90   <- paste0("$",round(dfc_rep[["p90"]], digits = 2))
sp10   <- paste0("$",round(dfc_rep[["p10"]], digits = 2))
sr9010 <- round(dfc_rep[["r9010"]], digits = 2)

```


.left-column[
Take for instance `r dfc_rep[["countryname"]][1]`, whose 90th percentile (`r sp90[1]`) is `r sr9010[1]` higher than the 10th percentile (`r sp10[1]`). 
]
.right-column[
```{r p1090gl2}
p_p10p902
```
]

---

.left-column[
Take for instance `r dfc_rep[["countryname"]][1]`, whose 90th percentile (`r sp90[1]`) is `r sr9010[1]` higher than the 10th percentile (`r sp10[1]`). In contrast, `r dfc_rep[["countryname"]][nrow(dfc_rep)]`'s  90th percentile (`r sp90[nrow(dfc_rep)]`) is `r sr9010[nrow(dfc_rep)]` higher than its 10th percentile (`r sp10[nrow(dfc_rep)]`). 
]
.right-column[
```{r p1090gl3}
p_p10p903
```
]
